<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>bao testsdasdasda</title>
</head>
<!-- https://fullcalendar.io/demos -->

<body>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="timeform">
                        <input class="form-control" type="time" id="appt" name="appt">
                        <input class="form-control" type="time" id="appt2" name="appt2">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary save">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <input type="submit" id="button" name="Removeall" />
    <div id='calendar-container'>
        <div id='calendar'></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.8/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.js"
        integrity="sha512-8Z5++K1rB3U+USaLKG6oO8uWWBhdYsM3hmdirnOEWp8h2B1aOikj5zBzlXs8QOrvY9OxEnD2QDkbSKKpfqcIWw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.serializeObject/2.0.3/jquery.serializeObject.min.js"
        integrity="sha512-DNziaT2gAUenXiDHdhNj6bfk1Ivv72gpxOeMT+kFKXB2xG/ZRtGhW2lDJI9a+ZNCOas/rp4XAnvnjtGeMHRNyg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
//
        // vi·∫øt h√†m l·∫•y xong x·ªï ra
        let arr = [
            { id: "time3", start: '2023-07-01T12:30:00'}, // will be parsed as if it were '2018-09-01T12:30:00Z'
            { id: "time1", start: '2023-07-01T12:30:00Z' }, // already in UTC, so won't shift
            { id: "time3", start: '2023-07-01T12:30:00' }, // will be parsed as if it were '2018-09-01T12:30:00Z'
            {
                id: "247",
                title: `14:15-15:15`,
                start: '2023-06-02',
                end: '2023-06-06',
            },
            {
                id: "1",
                title: `14:15-15:15`,
                start: '2023-06-13',
                end: '2023-06-15',
            }
        ];

        let id = 1;
        let calendar = null;
        let infos = {};
        let edit = {};

        window.addEventListener("load", initCallendar);
        function initCallendar() {
            var Calendar = FullCalendar.Calendar;
            var calendarEl = document.getElementById('calendar');
            calendar = new Calendar(calendarEl, {
                themeSystem: 'bootstrap5',
                contentHeight: 600,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth'
                },
                events: arr,
                selectable: true,
                editable: true,
                // eventOverlap: false,
                select: function (info) {
                    console.log("info select", info);
                    OpenModal();
                    //t·∫°o m·ªõi
                    infos = info;
                    Clear();
                },
                //Edit
                eventClick: function (info) {
                    console.log("eventClick", info);
                    edit = info;
                    OpenModalforEdit(info);
                    OpenModal();
                },
                eventResize: function (eventResizeInfo) {
                    console.log("eventResizeInfo", eventResizeInfo);

                    // alert(eventResizeInfo.event.title + " end is now " + eventResizeInfo.event.end);
                    // if (!confirm("is this okay?")) {
                    //     eventResizeInfo.revert();
                    // }

                    edit = eventResizeInfo;
                    OpenModalforEdit(eventResizeInfo);
                    OpenModal();
                },
                eventDrop: function (eventDropInfo) {
                    console.log("eventDropInfo", eventDropInfo);
                }
            });
            calendar.render();
        }

        function OpenModalforEdit(info) {
            let arr = info.event.title.split('-');
            $('#appt').val(arr[0]);
            $('#appt2').val(arr[1]);
        }

        function OpenModal(info) {
            $('#exampleModal').modal('show');
        }

        function Clear() {
            $("#timeform").trigger('reset');
        }

        function Createtime(data, infos) {
            let ID = ++id;
            calendar.addEvent(
                {
                    id: ID,
                    title: `${data.appt}-${data.appt2}`,
                    start: infos.startStr,
                    end: infos.endStr,
                });
            $('#exampleModal').modal('hide');
        }

        $(document).on('click', '.save', function (e) {
            e.preventDefault();

            let data = $('#timeform').serializeObject();

            // Edit
            console.log(edit);
            if (!jQuery.isEmptyObject(edit)) {
                infos = edit.event;
                let a = calendar.getEventById(edit.event._def.publicId);
                // c√≥ id l·∫•y id ra update th√¥i
                console.log("üöÄ ~ file: index.html:163 ~ edit.event._def.publicId:", edit.event._def.publicId)
                // Edit => d√πng h√†m (2)
                a.remove();

                // vi·∫øt 1 h√†m edit ajax x·ª≠ l√Ω Edit
                // Edit ok => remove
                // x·ª≠ l√Ω ok remove -> d√πng h√†m (1) render ra t·ª´ng c√°i -> l√∫c n√†y ko c·∫ßn remove
                edit = {};
            }
            else {
                // ko c√≥ id th√¨ add
                // Add render ra l√† xong
            }
            // Add new => d√πng h√†m (2) -> xong d√πng (1)
            Createtime(data, infos);

            // ch·∫°y c√°i h√†m (1)
        });

        // h√†m (1) vi·∫øt 1 c√°i h√†m ƒë·ªçc xong calendar.addEvent t·ª´ c√°i list
        // h√†m (2) (save ajax) 

        $('#button').on('click', function () {
            calendar.removeAllEvents();
        });
    </script>
</body>

</html>